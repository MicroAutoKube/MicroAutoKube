(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{304:(e,r,s)=>{"use strict";s.d(r,{default:()=>h});var t=s(5155),a=s(2115),l=s(5311);s(9437),s(9641).Buffer;var n=s(9509);let o=e=>new Promise((r,s)=>{let t=new FileReader;t.readAsText(e),t.onload=()=>{if(!i(t.result))return s(Error("Invalid SSH private key file"));let a=new FileReader;a.readAsDataURL(e),a.onload=()=>{r(a.result.split(",")[1])},a.onerror=s},t.onerror=s});n.env.ENCRYPTION_KEY;let i=e=>{let r=e.trim();return/^-----BEGIN (OPENSSH|RSA|DSA|EC) PRIVATE KEY-----/.test(r)&&/-----END (OPENSSH|RSA|DSA|EC) PRIVATE KEY-----$/.test(r)};var d=s(6766),u=s(2520),c=s(5799);let h=()=>{let[e,r]=(0,a.useState)(!1),[s,n]=(0,a.useState)([]),i=async e=>{try{"ssh_key"===e.globalAuth.mode&&e.globalAuth.sshKey instanceof File?e.globalAuth.sshKey=await o(e.globalAuth.sshKey):e.globalAuth.sshKey=null,e.nodes=await Promise.all(e.nodes.map(async e=>("ssh_key"===e.authMode&&e.sshKey instanceof File?e.sshKey=await o(e.sshKey):e.sshKey=null,e)));let r=await fetch("/api/clusters",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();return console.error("Failed to create cluster:",e),c.oR.error("❌ Failed to create cluster: ".concat(e.error||"Unknown error")),!1}let s=await r.json();return console.log("Cluster created successfully:",s),c.oR.success("✅ Cluster created successfully!"),h(),!0}catch(e){return console.error("Error creating cluster:",e),c.oR.error("❌ Error creating cluster"),!1}},h=async()=>{try{let e=await fetch("/api/clusters");if(!e.ok)throw Error("Failed to fetch clusters");let r=await e.json();n(r)}catch(e){console.error("Error fetching clusters:",e),c.oR.error("❌ Error fetching cluster list")}};return(0,a.useEffect)(()=>{h()},[]),(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("button",{className:"px-4 py-10 text-white rounded-2xl border-dashed border-2 w-full hover:bg-gray-700 text-4xl flex justify-center gap-5 font-bold",onClick:()=>r(!0),children:[(0,t.jsx)(d.default,{src:"/icons/plus.svg",alt:"Plus Icon",width:30,height:30})," Create Cluster"]}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-6 mt-10",children:s.map(e=>(0,t.jsx)(u.default,{cluster:e},e.id))}),(0,t.jsx)(l.default,{isOpen:e,setIsOpen:r,createCluster:i})]})}},2520:(e,r,s)=>{"use strict";s.d(r,{default:()=>n});var t=s(5155),a=s(2115),l=s(5695);let n=e=>{var r;let{cluster:s}=e,n=(0,l.useRouter)(),[o,i]=(0,a.useState)("Pending"),d=s.nodes.filter(e=>"MASTER"===e.role),u=null===(r=d[0])||void 0===r?void 0:r.ipAddress,c=d.length?d.map(e=>"".concat(e.ipAddress,":6443")).join(", "):"N/A";return(0,a.useEffect)(()=>{u&&fetch("/api/ping-kube?ip=".concat(u)).then(e=>e.json()).then(e=>{e.reachable?i("Running"):i("Pending")}).catch(()=>{i("Pending")})},[u]),(0,t.jsxs)("div",{className:"bg-black/50 rounded-xl p-5 text-white shadow-xl hover:bg-black hover:border-blue-700 border border-white/10 cursor-pointer transition",onClick:()=>{n.push("/dashboard/profile/".concat(s.id))},children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-2",children:s.name}),(0,t.jsxs)("p",{className:"text-sm mb-1",children:["IP: ",c]}),(0,t.jsxs)("p",{className:"text-sm font-medium ".concat((e=>{switch(e){case"Running":return"text-green-500";case"Error":return"text-red-500";default:return"text-yellow-400"}})(o)),children:["● ",o]})]})}},5311:(e,r,s)=>{"use strict";s.d(r,{default:()=>w});var t=s(5155);let a=["1.32.3","1.32.2","1.32.1","1.32.0","1.31.7","1.31.6","1.31.5","1.31.4","1.31.3","1.31.2","1.31.1","1.31.0","1.30.6","1.30.5","1.30.4","1.30.3","1.30.2","1.30.1","1.30.0"],l=["0.3.16","0.3.15","0.3.14","0.3.13","0.3.12","0.3.11","0.3.10","0.3.9","0.3.8","0.3.7","0.3.6","0.3.5"],n=["2.0.2","2.0.1","2.0.0","1.7.24","1.7.23","1.7.22","1.7.21","1.7.20","1.7.19","1.7.18","1.7.17","1.7.16","1.7.15","1.7.14","1.7.13","1.7.12","1.7.11","1.7.10","1.7.9","1.7.8","1.7.7","1.7.6","1.7.5","1.7.4","1.7.3","1.7.2","1.7.1","1.7.0","1.6.36","1.6.35","1.6.34","1.6.33","1.6.32","1.6.31","1.6.30","1.6.29","1.6.28","1.6.27","1.6.26","1.6.25","1.6.24","1.6.23","1.6.22","1.6.21","1.6.20","1.6.19","1.6.18","1.6.17","1.6.16","1.6.15","1.6.14"];var o=s(9437);let i=o.gk.object({hostname:o.gk.string().min(1,"Hostname is required"),ipAddress:o.gk.string().regex(/^(25[0-5]|2[0-4][0-9]|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4][0-9]|1\d{2}|[1-9]?\d)){3}$/,"Invalid IP address"),role:o.gk.enum(["MASTER","WORKER"])}),d=o.gk.discriminatedUnion("authMode",[o.gk.object({authMode:o.gk.literal("default"),username:o.gk.string().optional(),password:o.gk.string().optional(),sshKey:o.gk.any().optional()}),o.gk.object({authMode:o.gk.literal("username_password"),username:o.gk.string().min(1,"Username is required"),password:o.gk.string().min(1,"Password is required"),sshKey:o.gk.any().optional()}),o.gk.object({authMode:o.gk.literal("ssh_key"),sshKey:o.gk.any().refine(e=>e instanceof File||"string"==typeof e,{message:"SSH Key is required"}),username:o.gk.string().optional(),password:o.gk.string().optional()})]),u=o.gk.discriminatedUnion("mode",[o.gk.object({mode:o.gk.literal("username_password"),username:o.gk.string().min(1,"Global username is required"),password:o.gk.string().min(1,"Global password is required"),sshKey:o.gk.any().optional()}),o.gk.object({mode:o.gk.literal("ssh_key"),sshKey:o.gk.any().refine(e=>e instanceof File||"string"==typeof e,{message:"SSH Key is required"}),username:o.gk.string().optional(),password:o.gk.string().optional()})]),c=i.and(d),h=o.gk.object({clusterName:o.gk.string().min(1,"Cluster name is required"),toolInstallation:o.gk.string().min(1),kubernetesVersion:o.gk.string().min(1,"Kubernetes version is required"),containerRuntime:o.gk.string().min(1),containerVersion:o.gk.string().min(1,"Container version is required"),globalAuth:u,nodes:o.gk.array(c).min(1,"At least one node is required")});var g=s(5939),m=s(8212),p=s(2115),x=s(9911),b=s(5799),y=s(6710);let v=e=>{let{onFileAccepted:r,currentFile:s}=e,{getRootProps:a,getInputProps:l,isDragActive:n}=(0,y.VB)({multiple:!1,onDrop:e=>{if(e&&e.length>0){let s=e[0];if(!(/\.(pem|key|priv|txt)$/i.test(s.name)||!s.name.includes("."))){console.warn("❌ Invalid file type:",s.name);return}console.log("\uD83D\uDCC1 File dropped:",s),r(s)}else console.warn("⚠️ No valid file dropped.")}});return(0,t.jsxs)("div",{...a(),className:"w-full p-4 mt-2 rounded border-2 ".concat(n?"border-blue-400":"border-gray-700"," border-dashed bg-gray-800 text-white text-center cursor-pointer"),children:[(0,t.jsx)("input",{...l()}),s?(0,t.jsx)("p",{className:"text-green-400",children:s.name}):(0,t.jsx)("p",{children:"Drag & drop SSH key here, or click to select file"})]})},w=e=>{let{isOpen:r,setIsOpen:s,createCluster:i}=e,[d,u]=(0,p.useState)(""),[c,y]=(0,p.useState)("kubespray"),[w,j]=(0,p.useState)(""),[f,k]=(0,p.useState)("CONTAINERD"),[N,C]=(0,p.useState)(""),[A,S]=(0,p.useState)("username_password"),[E,K]=(0,p.useState)(""),[R,F]=(0,p.useState)(""),[P,_]=(0,p.useState)(null),[M,T]=(0,p.useState)([{id:(0,o.gZ)(),hostname:"",ipAddress:"",role:"MASTER",authMode:"default",username:"",password:"",sshKey:null}]),O=e=>{1!==M.length&&T(r=>r.filter(r=>r.id!==e))},I=(e,r,s)=>{T(t=>t.map(t=>t.id===e?{...t,[r]:s}:t))},D=async()=>{let e={clusterName:d,toolInstallation:c,kubernetesVersion:w,containerRuntime:f,containerVersion:N,globalAuth:{mode:A,username:E,password:R,sshKey:P},nodes:M.map(e=>({hostname:e.hostname,ipAddress:e.ipAddress,role:e.role,authMode:e.authMode,username:e.username,password:e.password,sshKey:e.sshKey}))},r=h.safeParse(e);if(!r.success){let e=r.error.errors[0];b.oR.error("❌ ".concat(e.message));return}await i(e)&&q()},q=()=>{u(""),j(""),k("CONTAINERD"),C(""),S("username_password"),K(""),F(""),_(null),T([{id:(0,o.gZ)(),hostname:"",ipAddress:"",role:"MASTER",authMode:"default",username:"",password:"",sshKey:null}]),s(!1)};return(0,t.jsx)(g.e,{appear:!0,show:r,as:p.Fragment,children:(0,t.jsxs)(m.lG,{as:"div",className:"relative z-50",onClose:q,children:[(0,t.jsx)(g.e.Child,{as:p.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md z-10"})}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-30",children:(0,t.jsx)(g.e.Child,{as:p.Fragment,enter:"ease-out duration-300",enterFrom:"scale-95 opacity-0",enterTo:"scale-100 opacity-100",leave:"ease-in duration-200",leaveFrom:"scale-100 opacity-100",leaveTo:"scale-95 opacity-0",children:(0,t.jsxs)(m.lG.Panel,{className:"bg-gray-900 p-10 rounded-lg shadow-2xl w-[60vw] border border-gray-700 overflow-auto max-h-[90vh]",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-white text-xl font-semibold",children:"Create Cluster"}),(0,t.jsx)("button",{onClick:q,className:"text-gray-400 hover:text-white",children:(0,t.jsx)(x.QCr,{size:18})})]}),(0,t.jsx)("input",{className:"w-full p-2 mt-4 rounded bg-gray-800 text-white border border-gray-700",placeholder:"Cluster Name",value:d,onChange:e=>u(e.target.value)}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("select",{className:"w-full p-2 mt-4 rounded bg-gray-800 text-white border border-gray-700",value:c,onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"kubespray",children:"Kubespray"}),(0,t.jsx)("option",{value:"kubekey",disabled:!0,children:"Kubekey (Coming Soon)"})]}),(0,t.jsx)("div",{className:"absolute right-5 top-5 text-yellow-400",children:(0,t.jsx)(x.TNq,{title:"Kubekey is coming soon!"})})]}),(0,t.jsxs)("select",{className:"w-full p-2 mt-4 rounded bg-gray-800 text-white border border-gray-700",value:w,onChange:e=>j(e.target.value),children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"Select Kubernetes Version"}),a.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),(0,t.jsxs)("select",{className:"w-full p-2 mt-4 rounded bg-gray-800 text-white border border-gray-700",value:f,onChange:e=>k(e.target.value),children:[(0,t.jsx)("option",{value:"CONTAINERD",children:"Containerd"}),(0,t.jsx)("option",{value:"DOCKER",children:"Docker"})]}),"DOCKER"===f&&(0,t.jsxs)("select",{className:"w-full p-2 mt-4 rounded bg-gray-800 text-white border border-gray-700",value:N,onChange:e=>C(e.target.value),children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"Select Docker Version"}),l.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),"CONTAINERD"===f&&(0,t.jsxs)("select",{className:"w-full p-2 mt-4 rounded bg-gray-800 text-white border border-gray-700",value:N,onChange:e=>C(e.target.value),children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"Select Containerd Version"}),n.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"text-white",children:"Global Authentication Mode"}),(0,t.jsxs)("select",{className:"w-full p-2 rounded bg-gray-800 text-white border border-gray-700 mt-1",value:A,onChange:e=>S(e.target.value),children:[(0,t.jsx)("option",{value:"username_password",children:"Username & Password"}),(0,t.jsx)("option",{value:"ssh_key",children:"SSH Key"})]}),"username_password"===A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{className:"w-full p-2 mt-2 rounded bg-gray-800 text-white border border-gray-700",placeholder:"Global Username",value:E,onChange:e=>K(e.target.value)}),(0,t.jsx)("input",{type:"password",className:"w-full p-2 mt-2 rounded bg-gray-800 text-white border border-gray-700",placeholder:"Global Password",value:R,onChange:e=>F(e.target.value)})]}),"ssh_key"===A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{className:"w-full p-2 mt-2 rounded bg-gray-800 text-white border border-gray-700",placeholder:"Global Username",value:E,onChange:e=>K(e.target.value)}),(0,t.jsx)(v,{onFileAccepted:e=>_(e),currentFile:P}),(0,t.jsx)("small",{className:"text-gray-400",children:"Accepted: .pem, .key, .priv"})]})]}),(0,t.jsx)("h3",{className:"text-white mt-6 font-medium",children:"Nodes"}),M.map((e,r)=>(0,t.jsxs)("div",{className:"mt-3 bg-gray-800 rounded p-4 relative",children:[(0,t.jsxs)("div",{className:"flex flex-col mr-10",children:[(0,t.jsx)("input",{className:"w-full p-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"Hostname",value:e.hostname,onChange:r=>I(e.id,"hostname",r.target.value)}),(0,t.jsx)("input",{className:"w-full p-2 mt-2 rounded bg-gray-700 text-white border border-gray-600",placeholder:"IP Address",value:e.ipAddress,onChange:r=>I(e.id,"ipAddress",r.target.value)}),(0,t.jsxs)("select",{className:"w-full p-2 mt-2 rounded bg-gray-700 text-white border border-gray-600",value:e.role,onChange:r=>I(e.id,"role",r.target.value),children:[(0,t.jsx)("option",{value:"MASTER",children:"Master"}),(0,t.jsx)("option",{value:"WORKER",children:"Worker"})]}),(0,t.jsxs)("select",{className:"w-full p-2 mt-2 rounded bg-gray-700 text-white border border-gray-600",value:e.authMode,onChange:r=>I(e.id,"authMode",r.target.value),children:[(0,t.jsx)("option",{value:"default",children:"Default (Global)"}),(0,t.jsx)("option",{value:"username_password",children:"Custom Username & Password"}),(0,t.jsx)("option",{value:"ssh_key",children:"Custom SSH Key"})]}),"username_password"===e.authMode&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{className:"w-full p-2 mt-2 rounded bg-gray-800 text-white border border-gray-700",placeholder:"Username",value:e.username,onChange:r=>I(e.id,"username",r.target.value)}),(0,t.jsx)("input",{type:"password",className:"w-full p-2 mt-2 rounded bg-gray-800 text-white border border-gray-700",placeholder:"Password",value:e.password,onChange:r=>I(e.id,"password",r.target.value)})]}),"ssh_key"===e.authMode&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{className:"w-full p-2 mt-2 rounded bg-gray-800 text-white border border-gray-700",placeholder:"Username",value:e.username,onChange:r=>I(e.id,"username",r.target.value)}),(0,t.jsx)(v,{onFileAccepted:r=>I(e.id,"sshKey",r),currentFile:e.sshKey}),(0,t.jsx)("small",{className:"text-gray-400",children:"Accepted: .pem, .key, .priv"})]})]}),(0,t.jsx)("button",{className:"absolute top-4 right-4 text-red-400",onClick:()=>O(e.id),children:(0,t.jsx)(x.qbC,{})})]},e.id)),(0,t.jsx)("button",{className:"mt-4 bg-blue-500 text-white p-2 rounded w-full",onClick:()=>{T(e=>[...e,{id:(0,o.gZ)(),hostname:"",ipAddress:"",role:"WORKER",authMode:"default",username:"",password:"",sshKey:null}])},children:"+ Add Node"}),(0,t.jsxs)("div",{className:"flex justify-end mt-6 space-x-2",children:[(0,t.jsx)("button",{className:"bg-gray-500 text-white px-4 py-2 rounded",onClick:q,children:"Cancel"}),(0,t.jsx)("button",{className:"bg-green-500 text-white px-4 py-2 rounded",onClick:D,children:"Create"})]})]})})})]})})}},7900:(e,r,s)=>{Promise.resolve().then(s.bind(s,304)),Promise.resolve().then(s.bind(s,5311)),Promise.resolve().then(s.bind(s,2520))},9437:(e,r,s)=>{"use strict";s.d(r,{gZ:()=>a,gk:()=>t}),s(9980),s(8777);let t=s(5594).z,a=s(1368).A},9825:()=>{}},e=>{var r=r=>e(e.s=r);e.O(0,[711,268,63,799,610,441,684,358],()=>r(7900)),_N_E=e.O()}]);